"use strict";var xr=null,xu=null,cb=null,ps=null,pa=null,pi=null,pb=null,pn=null,pp=null,mn=100,mx=209715200,ex=5012,hd=false,rt='',fpt='^http(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*\/([0-9a-zA-Z\-\.\?\/\+&amp;%\$#_]*)?[.]([a-zA-Z0-9]{2,4})$',ftt='URL must be a file address, http://... or https://..., and not a page or other.',hpt='^http(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(\/?)([0-9a-zA-Z\-\.\?\/\+&amp;%\$#_]*)?$',htt='URL must be a page address, http://... or https://....';function byId(i){return document.getElementById(i)}function toSize(b,t){var ss=['B','KB','MB','GB','TB'];if(typeof b==='undefined')return '';if(b<1)return '0 B';var i=Math.floor(Math.log(b)/Math.log(1024));if(i<0||i>4)return '';if(t)return(b/Math.pow(1024,i)).toFixed(2).replace(/\.?0*$/,'')+' '+ss[i];else return(b/Math.pow(1024,i)).toFixed(1)+' '+ss[i]}function checkSize(id,t,l,m,n,x){var fe=byId(id);if(!fe){if(m){alert('Please select a '+t+'.');return -1}return 0}if(n&&(fe.value=='')){if(l!=''){var l=byId(l);if(l){alert(l.innerHTML.replace(':','.'));return -1}}alert('Please select a '+t+'.');return -1}if(!fe.files)return 0;if(!fe.files.length)return 0;if(fe.files.length!=1)return 0;if(typeof fe.files[0].size==='undefined')return 0;if(x==0)x=mx;var s=fe.files[0].size;if(s>x){alert(t+' is too big ('+toSize(s,true)+'), the maximum upload file size is '+toSize(x,true)+'.');return -1}if(s==0){alert(t+' is too small, it is an empty file.');return -1}if(s<mn){alert(t+' is too small, the file size is '+s+' bytes.');return -1}return s}function checkTotal(s){if(s>(mx+ex)){alert('The total file size must be less than '+toSize(mx,true)+'.');return false}return true}function sendData(){var se=byId('source');if(!se)return;var u=byId('url');if(u&&(se.value=='file'))se.value='url';if(!u&&(se.value=='url'))se.value='file';if(checkSize('file','This file','file-label',false,true,0)==-1)return;if(u){var uv=u.value.trim();var fl=true;if(uv==''||uv=='http://'||uv=='https://'||uv.length<=10||uv.length>=100)fl=false;if(fl){if(!validRegx(u))fl=false}if(!fl){var l=byId('file-label');if(l)alert(l.innerHTML.replace(':','.'));return}}if(typeof validOptions==='function'){if(!validOptions())return}if(typeof customOptions==='function'){if(!customOptions())return}cb=byId('convert-button');ps=byId('progress-status');pa=byId('progress-action');uploadClear(false);pi=document.createElement('img');pi.setAttribute('id','progress-image');pi.setAttribute('src','/img/progressbar.gif');pi.setAttribute('style','height:12px;width:80px;');pb=byId('progress-bar');pb.appendChild(pi);if(pa)pa.innerHTML='(<a href="#" onclick="cancelUpload();return false;">cancel</a>)';if(ps)ps.innerHTML='uploading';xu=new XMLHttpRequest();xu.open('GET','/get/host',true);xu.onabort=uploadAbort;xu.onerror=uploadError;xu.onload=uploadURLLoad;xu.send(null);cb.disabled=true}function uploadURLLoad(){if(!xu)return;if(!((xu.readyState==4)&&(xu.status==200)))return;var u=xu.responseText;if((u.substring(0,7)==='http://')||(u.substring(0,8)==='https://'))sendUpload(u);else uploadError()}function sendUpload(sendurl){var form=byId('form');if(!form)return;var opt=byId('show-option');if(opt)opt.disabled=true;var formData=new FormData(form);xr=new XMLHttpRequest();xr.onabort=uploadAbort;xr.onerror=uploadError;xr.onload=uploadLoad;if('upload' in xr){if('onprogress' in xr.upload)xr.upload.onprogress=uploadProgress}xr.open('POST',sendurl,true);xr.send(formData);cb.disabled=true}function uploadProgress(e){if(!xr)return;if(e.lengthComputable&&xr){pp=byId('progress-percent');if(!pp){if(pi){pb.removeChild(pi);pi=null}pn=document.createElement('div');pn.setAttribute('class','progress-banner');pn.setAttribute('style','border-color:#acacac');pb.appendChild(pn);pp=document.createElement('div');pp.setAttribute('id','progress-percent');pp.setAttribute('class','progress-percent');pn.appendChild(pp)}if(e.total>(mx+ex)){uploadAbort();alert('The file must be less than '+toSize(mx,true));return}var per=0;if(e.total>0)per=Math.round((e.loaded/e.total)*100);if(per<0)per=0;if(per>100)per=100;if(ps)ps.innerHTML=toSize(e.loaded,false)+'/'+toSize(e.total,false);if(pp)pp.setAttribute('style','width:'+per+'%')}}function uploadAbort(){var fl=((pp)||(pn)||(pi)||(xu)||(xr));uploadClear(true);if(fl)alert('Upload canceled.')}function uploadError(){var fl=((pp)||(pn)||(pi)||(xu)||(xr));uploadClear(true);if(fl)alert('Failed to upload, please try again.')}function uploadClear(fl){if(ps)ps.innerHTML='';if(pa)pa.innerHTML='';if(pp){pn.removeChild(pp);pp=null}if(pn){pb.removeChild(pn);pn=null}if(pi){pb.removeChild(pi);pi=null}if(xu){if(!fl&&(xu.readyState!=0)&&(xu.readyState!=4))xu.abort();xu=null}if(xr){if((!fl&&xr.readyState!=0)&&(xr.readyState!=4))xr.abort();xr=null}if(cb){if(cb.disabled)cb.disabled=false}var opt=byId('show-option');if(opt)opt.disabled=false;hd=false;rt=''}function uploadLoad(){if(!xr)return;if(!((xr.readyState==4)&&(xr.status==200))){uploadError();return}if(ps)ps.innerHTML='completed';if(pa)pa.innerHTML='';var u='';var text=xr.responseText;if((text.substring(0,7)==='http://')||(text.substring(0,8)==='https://'))u=text;if(u==''){uploadError();return}if(hd){rt=u;return}window.location.href=u}function setSource(){var se=byId('source');if(!se)return;if(se.value=='file'){setFile();setFormat()}else setURL()}function setFile(){var i=byId('file-input');if(!i)return;var e=byId('url');if(e)i.removeChild(e);e=byId('file');if(e)return;e=document.createElement('input');e.setAttribute('id','file');e.setAttribute('name','file');e.setAttribute('type','file');e.setAttribute('class','input-file');e.setAttribute('value','');e.setAttribute('onclick','setFormat()');if(typeof setCustomFormat==='function')e.setAttribute('onclick','setCustomFormat()');i.appendChild(e);var l=byId('file-label');cb=byId('convert-button');if(l)l.innerHTML='Select a file to upload and '+cb.value.toLowerCase()+':';var h=byId('hint');if(h)h.innerHTML='(max file size '+toSize(mx,true)+')'}function setURL(){var i=byId('file-input');if(!i)return;var e=byId('file');if(e)i.removeChild(e);e=byId('url');if(e)return;e=document.createElement('input');e.setAttribute('id','url');e.setAttribute('name','url');e.setAttribute('type','text');e.setAttribute('class','input-file');e.setAttribute('value','http://');e.setAttribute('maxlength','100');var pt=fpt;var tt=ftt;var f=byId('from');if(f&&(f.value=='html')){pt=hpt;tt=htt}e.setAttribute('pattern',pt);e.setAttribute('title',tt);i.appendChild(e);var l=byId('file-label');cb=byId('convert-button');if(l)l.innerHTML='Enter URL of the file to '+cb.value.toLowerCase()+':';var h=byId('hint');if(h)h.innerHTML='(http://... or https://..., max file size '+toSize(mx,true)+')'}function setAccept(){var fs=new Array();var as=new Array();var e;if(fs.length==0){e=byId('formats');if(e)fs=e.value.split(';')}if(as.length==0){e=byId('accepts');if(e)as=e.value.split(';')}var f=byId('from');if((fs.length==as.length)&&f){e=byId('file');if(e){var a='';if((f.value!='')&&(f.value.length<=4))a='.'+f.value;for(var i=0;i<fs.length;i++){if(fs[i]==f.value){a=as[i];break}}if(a!=''){if(e.getAttribute('accept')!=a){e.setAttribute('accept',a);if(e.value&&(e.value!='')){var n=e.value.lastIndexOf('.');if(n>=0){var ev=e.value.substr(n).toLowerCase();if(a.indexOf(ev)<0)e.value=''}}}}}}}function setFormat(){var e=byId('format');var f=byId('from');var t=byId('to');if(e&&f&&t){var ft=e.value.toLowerCase().split(' to ');if (ft.length==2){f.value=ft[0].replace(' ', '-');t.value=ft[1];if(f){var u=byId('url');if(u){if((f.value=='html')&&(u.pattern!=hpt)){u.pattern=hpt;u.title=htt}if((f.value!='html')&&(u.pattern==hpt)){u.pattern=fpt;u.title=ftt}}}}}setAccept();if(typeof cleanOption==='function')cleanOption(false)}function cancelUpload(){hd=true;if(!confirm('Are you sure you want to stop uploading?')){hd=false;var u=rt;if(u!=''){window.location.href=u}}else{hd=false;uploadClear(false)}}function validRegx(e){if(e.validity){if(e.validity.valid!==true)return false}else{var pt=e.getAttribute('pattern');if(pt){if(pt!=''){var rx=new RegExp(pt);if(!rx.test(e.value))return false}}}return true}
